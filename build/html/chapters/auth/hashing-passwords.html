<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>19.2. Hashing Passwords &mdash; Textbook Template 2022 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="19.3. Getting Started with Identity" href="scaffolding.html" />
    <link rel="prev" title="19.1. Introduction to Authentication" href="intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: purple" >
            <a href="../../index.html" class="icon icon-home"> Textbook Template
            <img src="../../_static/lc-ed-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction-and-setup/index.html">1. Introduction and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/index.html">2. Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control-flow-and-collections/index.html">3. Control Flow and Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classes/index.html">4. Classes in C#, Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classes-part2/index.html">5. Classes and Objects, Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unit-testing/index.html">6. Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inheritance/index.html">7. Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces-and-polymorphism/index.html">8. Interfaces and Polymorphism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-intro/index.html">9. Introduction to ASP.NET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-controllers-and-routes/index.html">10. Controllers and Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exceptions/index.html">11. Rules to the Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vstools/index.html">12. Tools in Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../razor-views/index.html">13. Razor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-model-classes/index.html">14. Models and Model Binding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-model-validation/index.html">15. ViewModels and Model Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enums/index.html">16. Enumeration Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm-intro/index.html">17. Introduction to Object-Relational Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm-relationships/index.html">18. Relationships in Object-Relational Mapping</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">19. Authentication</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">19.1. Introduction to Authentication</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">19.2. Hashing Passwords</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#two-way-encryption">19.2.1. Two-Way Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-way-encryption">19.2.2. One-Way Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#password-verification-with-hashes">19.2.3. Password Verification With Hashes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#which-hash-function-does-identity-use">19.2.4. Which Hash Function Does Identity Use?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-your-understanding">19.2.5. Check Your Understanding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scaffolding.html">19.3. Getting Started with Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="users.html">19.4. Registrations and Logins</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">19.5. Configuring Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="authorization.html">19.6. Identity and Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity-management.html">19.7. Identity Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="studio.html">19.8. Studio: TechJobs Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/index.html">20. Introduction to Web APIs &amp; REST</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/sql-install.html">Installing SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/vs-troubleshooting.html">Visual Studio Operational Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/postman-install.html">Installing Postman</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/exercise-solutions/index.html">Exercise Solutions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: purple" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Textbook Template</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">19. </span>Authentication</a> &raquo;</li>
      <li><span class="section-number">19.2. </span>Hashing Passwords</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/chapters/auth/hashing-passwords.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="hashing-passwords">
<span id="id1"></span><h1><span class="section-number">19.2. </span>Hashing Passwords<a class="headerlink" href="#hashing-passwords" title="Permalink to this headline"></a></h1>
<p id="index-0">Simple authentication allows users to log in to a site with a username and password.
To implement authentication, we need to be able to verify that a user’s password is correct.
However, <strong>you should NEVER store passwords in a database.</strong> Seriously. Don’t do it. Ever.</p>
<p>Storing passwords in a database is incredibly insecure.
A hacker may break into the database, gaining access to every user account.
Or a deviant employee with access to the database may do the same.</p>
<p>Fortunately, it is possible for us to implement simple authentication <em>without</em> storing passwords, by using a technique called <strong>password hashing</strong>.
Password hashing is a particular type of encryption that we will explore throughout the rest of this section.</p>
<div class="section" id="two-way-encryption">
<h2><span class="section-number">19.2.1. </span>Two-Way Encryption<a class="headerlink" href="#two-way-encryption" title="Permalink to this headline"></a></h2>
<p id="index-1">When you think of encryption, you might think of WWII or the Cold War, when the militaries of various countries exchanged secret messages that were unreadable by their enemies.
This type of encryption is <strong>two-way encryption</strong>.
A message is <em>encoded</em> with a key before being sent, and when it is received, it is <em>decoded</em> by another key.</p>
<div class="figure align-default" id="id2">
<img alt="A two-way encryption flow. A key is used to encrypt sensitive data. After being transmitted, another key decrypts it." src="../../_images/two-way-encryption.png" />
<p class="caption"><span class="caption-text">Two-way encryption (Created by Munkhzaya Ganbold, licensed via <a class="reference external" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank">CC BY-SA<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>)</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</div>
</div>
<div class="section" id="one-way-encryption">
<h2><span class="section-number">19.2.2. </span>One-Way Encryption<a class="headerlink" href="#one-way-encryption" title="Permalink to this headline"></a></h2>
<span class="target" id="index-2"></span><p id="index-3"><strong>One-way encryption</strong>, also known as <strong>hashing</strong>, encodes a message in a way that makes it <em>nearly</em> impossible to decode.
An algorithm implementing a one-way encryption algorithm is a <strong>cryptographic hash function</strong> (we’ll usually leave off “cryptographic”).
For a specific message, the output of a hash function is a <strong>hash</strong>.</p>
<p>The hashing process is essentially just the top half of the diagram above.
While it might not be clear yet, hashing allows us to securely store passwords and still be able to validate a user’s submitted password.
Precisely <em>how</em> this is done will be explored in a moment.
The diagram below shows the general flow of how hashing works to secure the site.</p>
<div class="figure align-default" id="id3">
<img alt="Diagram showing how encoded passwords are compared to a submitted password to authenticate a user." src="../../_images/hashingdiagram.png" />
<p class="caption"><span class="caption-text">Diagram showing how encoded passwords are compared to a submitted password to authenticate a user.</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</div>
<p>It can be difficult to write a good hash function, so thankfully you will never have to.
Over the years, some very smart people have created some very good hash functions.
However, it is important to understand how the properties of a hash function allow for secure password storage.
For our purposes, it is only important that we consider a hash function to have these properties:</p>
<ol class="arabic simple" id="hash-properties">
<li><p><strong>Deterministic</strong>: If we encode a message with the function at different points in time then we always get the same result.</p></li>
<li><p><strong>Hard to reverse</strong>: It is infeasible to calculate the input value that yields a given hash.</p></li>
<li><p><strong>Hash values are ALMOST unique</strong>: If <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are two different messages, then it is <em>extremely</em> unlikely that they have the same hash value. By “extremely unlikely” we mean that this is something like a one-in-a-trillion likelihood (for example, there are only about 8 billion people on earth).</p></li>
<li><p><strong>Similar messages have VERY different hash values</strong>: In other words, if we change a message only slightly, the resulting hash value is <em>very</em> different. A function that returned <code class="docutils literal notranslate"><span class="pre">AlXL3M_ws</span></code> for the message <code class="docutils literal notranslate"><span class="pre">&quot;LaunchCode&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">AlXL3M_wt</span></code> for the message <code class="docutils literal notranslate"><span class="pre">&quot;LaunchCodf&quot;</span></code> would not be a suitable hash function.</p></li>
</ol>
</div>
<div class="section" id="password-verification-with-hashes">
<h2><span class="section-number">19.2.3. </span>Password Verification With Hashes<a class="headerlink" href="#password-verification-with-hashes" title="Permalink to this headline"></a></h2>
<p>Our application will select a particular hash function. Let’s call it <code class="docutils literal notranslate"><span class="pre">h</span></code>.
Then, for a message <code class="docutils literal notranslate"><span class="pre">x</span></code>, the hash value will be the result of calling <code class="docutils literal notranslate"><span class="pre">h</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">x</span></code>.
Invoked, this looks like <code class="docutils literal notranslate"><span class="pre">h(x)</span></code>.  Rather than store passwords in a database, we will store their hash values.</p>
<p>Consider a fictional user that wants to sign up for our site, Jamie.
Jamie likes Taylor Swift, so their desired username is <code class="docutils literal notranslate"><span class="pre">tswizzle_fan</span></code> and their desired password is <code class="docutils literal notranslate"><span class="pre">lover1989</span></code> (not a great password choice, by the way, but we’ve seen worse).</p>
<p>When Jamie registers for an account on our site, we will call our hash function with their password:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">string</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="s">&quot;lover1989&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// returns &quot;bd62d7e13ef465fa705f30de198ba0cb&quot;</span>
</pre></div>
</div>
<p>Then we store Jamie’s username along with her hashed password in our <code class="docutils literal notranslate"><span class="pre">user</span></code> table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>username</p></th>
<th class="head"><p>passwordHash</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tswizzle_fan</p></td>
<td><p>bd62d7e13ef465fa705f30de198ba0cb</p></td>
</tr>
</tbody>
</table>
<p>This is very secure. Even if somebody breaks into the database and finds Jamie’s info, they will not be able to log in. Since we used a hash function, the hacker will have a very hard time turning the hash into a password (see <a class="reference internal" href="#hash-properties"><span class="std std-ref">property 2</span></a>).</p>
<p>We can still authenticate Jamie, however. When they come to our site to log in, they will submit a username and password. Let’s call the password value <code class="docutils literal notranslate"><span class="pre">submittedPassword</span></code>. Some basic logic will allow us to determine, with an <em>extremely</em> high rate of probability, whether or not the pair is valid.</p>
<p>To check Jamie’s username/password pair, we could do something like this:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">// fetches Jamie&#39;s user object from the database</span>
<span class="linenos"> 2</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">GetUserByUsername</span><span class="p">(</span><span class="s">&quot;tswizzle_fan&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1">// gets the hash value stored on their object</span>
<span class="linenos"> 5</span><span class="kt">string</span><span class="w"> </span><span class="n">passwordHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="n">PasswordHash</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1">// hashes the submitted password</span>
<span class="linenos"> 8</span><span class="kt">string</span><span class="w"> </span><span class="n">submittedHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="n">submittedPassword</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">passwordHash</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">submittedHash</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="p">{</span><span class="w"></span>
<span class="linenos">12</span><span class="w">   </span><span class="c1">// the hashes are the same, the passwords can be assumed to be the same</span>
<span class="linenos">13</span><span class="p">}</span><span class="w"></span>
<span class="linenos">14</span><span class="k">else</span><span class="w"></span>
<span class="linenos">15</span><span class="p">{</span><span class="w"></span>
<span class="linenos">16</span><span class="w">   </span><span class="c1">// the hashes are different, so the passwords are definitely different</span>
<span class="linenos">17</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The conditional compares the values of the hash stored in the database with the hash generated from the <em>submitted</em> password. By <a class="reference internal" href="#hash-properties"><span class="std std-ref">property 1</span></a>, we know that if the hash values are different, then there is no way the passwords are the same. By <a class="reference internal" href="#hash-properties"><span class="std std-ref">property 3</span></a>, we can safely assume that the passwords are the same.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>When using Identity, the library handles hashing passwords for newly registered users and comparing hashes when logging in a user.
The example above is just an example and meant to illustrate what is going on under the hood of Identity.</p>
</div>
<div class="section" id="hashing-isn-t-perfect">
<h3><span class="section-number">19.2.3.1. </span>Hashing Isn’t Perfect<a class="headerlink" href="#hashing-isn-t-perfect" title="Permalink to this headline"></a></h3>
<p id="index-4">Using hash functions to process passwords is not a cure-all.
One vulnerability is the possibility for <strong>collisions</strong>.
A collision occurs when two different messages have the same hash value.
By <a class="reference internal" href="#hash-properties"><span class="std std-ref">property 3</span></a>, this is supposed to be rare.
However, if a collision is found for a given hash function, then it may be possible to create an algorithm to <em>generate</em> collisions.
In other words, given a specific hash value, the algorithm could generate a string with the <em>same</em> hash value.</p>
<p id="index-5">The once-popular MD5 and SHA1 hash algorithms <a class="reference external" href="https://arstechnica.com/information-technology/2017/02/at-deaths-door-for-years-widely-used-sha1-function-is-now-dead/" target="_blank">quickly become obsolete<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> (for cryptographic purposes, at least) once collisions were found.</p>
<p>Most hashing algorithms become more vulnerable as global computing power increases.
If a hacker breaks into a database, they will obtain the hashes of all of its users’ passwords.
Since only a small handful of hash functions are commonly used, they might simply try millions of strings with each of the more popular hash functions and wait until they find a match.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>The widespread use of brute force attacks is why it is always a bad idea to use a password that:</p>
<ul class="simple">
<li><p>is ranked as one of the <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_the_most_common_passwords" target="_blank">most commonly used passwords<i class="fas fa-external-link-alt" aria-hidden="true"></i></a></p></li>
<li><p>utilizes publicly accessible information about you, such as birth date or address</p></li>
<li><p>uses common words from the dictionary</p></li>
</ul>
<p>When trying to crack a password hash using brute force, these are the first items a hacker will attempt to use.</p>
</div>
</div>
</div>
<div class="section" id="which-hash-function-does-identity-use">
<span id="index-6"></span><h2><span class="section-number">19.2.4. </span>Which Hash Function Does Identity Use?<a class="headerlink" href="#which-hash-function-does-identity-use" title="Permalink to this headline"></a></h2>
<p>Identity contains its own password hasher called <strong>IdentityV3</strong>. When a new user is added to the database, their inputted password is passed to IdentityV3.
IdentityV3 is not its own hashing algorithm, but it uses <a class="reference external" href="https://tools.ietf.org/html/rfc2898#section-5.2" target="_blank">PBKDF2<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> for hashing.</p>
<p>IdentityV3 is named after the third version of Identity and is the default password hasher.
IdentityV2 corresponds to the second version of Identity and may still be in use in some code bases.
As a result, developers can still specify that IdentityV2 needs to be used in the configuration options.</p>
</div>
<div class="section" id="check-your-understanding">
<h2><span class="section-number">19.2.5. </span>Check Your Understanding<a class="headerlink" href="#check-your-understanding" title="Permalink to this headline"></a></h2>
<div class="admonition-question admonition">
<p class="admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p>True/False: One-way encryption does not involve decryption.</p>
<ol class="arabic simple">
<li><p>True</p></li>
<li><p>False</p></li>
</ol>
</div>
<div class="admonition-question admonition">
<p class="admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p>Which of the following best describes hashing?</p>
<ol class="arabic simple">
<li><p>Hashing is the process of encrypting plaintext so that it is very difficult to obtain the original message.</p></li>
<li><p>Hashing is more secure than two-way encryption but less useful because it does not decode an encoded message.</p></li>
<li><p>Hashing cannot confirm that two passwords are the same because the original values are never saved.</p></li>
<li><p>Hashing smashing.</p></li>
</ol>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro.html" class="btn btn-neutral float-left" title="19.1. Introduction to Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scaffolding.html" class="btn btn-neutral float-right" title="19.3. Getting Started with Identity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, LaunchCode.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>