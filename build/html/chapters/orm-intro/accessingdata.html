<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>17.2. Accessing Data &mdash; Textbook Template 2022 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="17.3. Working with Data Stores" href="data-stores.html" />
    <link rel="prev" title="17.1. Object-Relational Mapping" href="background.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: purple" >
            <a href="../../index.html" class="icon icon-home"> Textbook Template
            <img src="../../_static/lc-ed-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction-and-setup/index.html">1. Introduction and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-types/index.html">2. Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control-flow-and-collections/index.html">3. Control Flow and Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classes/index.html">4. Classes in C#, Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classes-part2/index.html">5. Classes and Objects, Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unit-testing/index.html">6. Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inheritance/index.html">7. Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces-and-polymorphism/index.html">8. Interfaces and Polymorphism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-intro/index.html">9. Introduction to ASP.NET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-controllers-and-routes/index.html">10. Controllers and Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exceptions/index.html">11. Rules to the Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vstools/index.html">12. Tools in Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../razor-views/index.html">13. Razor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-model-classes/index.html">14. Models and Model Binding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aspdotnet-model-validation/index.html">15. ViewModels and Model Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enums/index.html">16. Enumeration Types</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">17. Introduction to Object-Relational Mapping</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="background.html">17.1. Object-Relational Mapping</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">17.2. Accessing Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-stores-video">17.2.1. Data Stores - Video</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-stores-text">17.2.2. Data Stores - Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrations-video">17.2.3. Migrations - Video</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrations-text">17.2.4. Migrations - Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-your-understanding">17.2.5. Check Your Understanding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data-stores.html">17.3. Working with Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">17.4. Exercises: OMG the ORM!</a></li>
<li class="toctree-l2"><a class="reference internal" href="studio.html">17.5. Studio: OMG More ORM!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../orm-relationships/index.html">18. Relationships in Object-Relational Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auth/index.html">19. Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/index.html">20. Introduction to Web APIs &amp; REST</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/sql-install.html">Installing SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/vs-troubleshooting.html">Visual Studio Operational Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/postman-install.html">Installing Postman</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/exercise-solutions/index.html">Exercise Solutions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: purple" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Textbook Template</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">17. </span>Introduction to Object-Relational Mapping</a> &raquo;</li>
      <li><span class="section-number">17.2. </span>Accessing Data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/chapters/orm-intro/accessingdata.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="accessing-data">
<span id="id1"></span><h1><span class="section-number">17.2. </span>Accessing Data<a class="headerlink" href="#accessing-data" title="Permalink to this headline"></a></h1>
<p>Now that we have connected our C# application to a MySQL database, we need to set up our C# code to interact with the new schema. In the previous chapters, we learned about performing basic operations on a database and its tables, such as creating, reading, updating, and deleting rows. One of the reasons we use ORM is so that now we can write C# code in our application to manage our relational database.</p>
<div class="section" id="data-stores-video">
<span id="intro-to-data-stores"></span><span id="index-0"></span><h2><span class="section-number">17.2.1. </span>Data Stores - Video<a class="headerlink" href="#data-stores-video" title="Permalink to this headline"></a></h2>
<p>While classes determine the structure of a table in our relational database, a <strong>data store</strong> does the work of inserting, updating, and retrieving data from the database.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>If you want to verify what code this video starts with, check out the <a class="reference external" href="https://github.com/LaunchCodeEducation/CodingEventsDemo/tree/db-setup" target="_blank">db-setup<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> branch. If you want to verify what code this video ends with, check out the <a class="reference external" href="https://github.com/LaunchCodeEducation/CodingEventsDemo/tree/persistent-data-store" target="_blank">persistent-data-store<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> branch.</p>
</div>

<div style="text-align:center;"><iframe width="800" height="450" src="https://www.youtube.com/embed/NV_Tw9sQeEQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p></p>
</div>
<div class="section" id="data-stores-text">
<h2><span class="section-number">17.2.2. </span>Data Stores - Text<a class="headerlink" href="#data-stores-text" title="Permalink to this headline"></a></h2>
<p id="index-1">In our work so far, we have been using an in-application data store,. This is the class <code class="docutils literal notranslate"><span class="pre">EventData</span></code>. The <code class="docutils literal notranslate"><span class="pre">EventData</span></code> class is an
<strong>in-memory data store</strong>. I keeps track of new events using a C# data structure, which gets deleted from memory every time the app shuts
down. With EF, we can create a <strong>persistent data store</strong>. A persistent data store retains data even when an app shuts down.</p>
<div class="section" id="creating-a-dbcontext">
<h3><span class="section-number">17.2.2.1. </span>Creating a <code class="docutils literal notranslate"><span class="pre">DbContext</span></code><a class="headerlink" href="#creating-a-dbcontext" title="Permalink to this headline"></a></h3>
<p>To create a persistent data store for our <code class="docutils literal notranslate"><span class="pre">Event</span></code> class, we can extend the class <code class="docutils literal notranslate"><span class="pre">DbContext</span></code>, which is provided by EF. Here’s what that looks like.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">using</span><span class="w"> </span><span class="nn">CodingEventsDemo.Models</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 2</span><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">namespace</span><span class="w"> </span><span class="nn">CodingEventsDemo.Data</span><span class="w"></span>
<span class="linenos"> 5</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">   </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EventDbContext</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DbContext</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Event</span><span class="p">&gt;</span><span class="w"> </span><span class="n">Events</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="nf">EventDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">EventDbContext</span><span class="p">&gt;</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="linenos">13</span><span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="linenos">14</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="linenos">15</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This new class is placed in the <code class="docutils literal notranslate"><span class="pre">Data</span></code> directory and namespace. By convention, we name it <code class="docutils literal notranslate"><span class="pre">EventDbContext</span></code> since it is going to be used to work with <code class="docutils literal notranslate"><span class="pre">Event</span></code> objects and data. We extend <code class="docutils literal notranslate"><span class="pre">DbContext</span></code>, which will provide most of the base functionality that we need. More on this in the next section.</p>
<p>This extension <em>must</em> provide a property of type <code class="docutils literal notranslate"><span class="pre">DbSet&lt;Event&gt;</span></code>. The <code class="docutils literal notranslate"><span class="pre">DbSet</span></code> class provides methods for querying sets of objects of the given type (in this case, <code class="docutils literal notranslate"><span class="pre">Event</span></code>). In the next section, we will explore how to use these methods.</p>
<p>The only additional code that we need to add is a constructor that calls the constructor from the base class.</p>
<p>This basic data store template can be used for any class that you want to persist in a database. Each such class will need its own data store.</p>
</div>
<div class="section" id="registering-a-data-store">
<h3><span class="section-number">17.2.2.2. </span>Registering a Data Store<a class="headerlink" href="#registering-a-data-store" title="Permalink to this headline"></a></h3>
<p>In order to make ASP.NET aware of this data store, we need to register <code class="docutils literal notranslate"><span class="pre">EventDbContext</span></code> in the <code class="docutils literal notranslate"><span class="pre">Startup</span></code> class. <code class="docutils literal notranslate"><span class="pre">Startup</span></code> is automatically executed every time our app starts up, and is a place where application configuration can be customized.</p>
<p>Open up <code class="docutils literal notranslate"><span class="pre">Startup.cs</span></code> and find the <code class="docutils literal notranslate"><span class="pre">ConfigureServices</span></code> method. By default, it looks like this.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="linenos">26</span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span><span class="w"> </span><span class="n">services</span><span class="p">)</span><span class="w"></span>
<span class="linenos">27</span><span class="p">{</span><span class="w"></span>
<span class="linenos">28</span><span class="w">   </span><span class="n">services</span><span class="p">.</span><span class="n">AddControllersWithViews</span><span class="p">();</span><span class="w"></span>
<span class="linenos">29</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>A persistent data store is considered a service in ASP.NET, and we can register this service by add the following code to <code class="docutils literal notranslate"><span class="pre">ConfigureServices</span></code>.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="linenos">29</span><span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">EventDbContext</span><span class="p">&gt;(</span><span class="n">options</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"></span>
<span class="linenos">30</span><span class="w">      </span><span class="n">options</span><span class="p">.</span><span class="n">UseMySql</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetConnectionString</span><span class="p">(</span><span class="s">&quot;DefaultConnection&quot;</span><span class="p">)));</span><span class="w"></span>
</pre></div>
</div>
<p>Don’t worry too much about the intricate details of what this code is doing. Simply note the following points:</p>
<ul class="simple">
<li><p>We are calling the <code class="docutils literal notranslate"><span class="pre">AddDbContext&lt;EventDbContext&gt;</span></code> method of the <code class="docutils literal notranslate"><span class="pre">services</span></code> object. Referencing <code class="docutils literal notranslate"><span class="pre">EventDbContext</span></code> here ensures that we are registering the data store that we just created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Configuration.GetConnectionString(&quot;DefaultConnection&quot;)</span></code> will retrieve the database connection string from <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> that we configured in the previous section. This ensures that the data store interacts with the specific database configured there. Note that it is possible for an application to have connections to multiple databases.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">options.UseMySql</span></code> is called. This ensures that <code class="docutils literal notranslate"><span class="pre">EventDbContext</span></code> is a data store that interacts with a MySQL database.</p></li>
</ul>
</div>
<div class="section" id="configuring-a-primary-key">
<span id="index-2"></span><h3><span class="section-number">17.2.2.3. </span>Configuring a Primary Key<a class="headerlink" href="#configuring-a-primary-key" title="Permalink to this headline"></a></h3>
<p>As you learned previously, every relational table should have a primary key. When working with ORM, this means that every <strong>persistent class</strong> needs a primary key property. A persistent class is a class that we want to store (or persist) in a database.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">Event</span></code> class currently has an ID field.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="linenos">16</span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos">17</span><span class="k">static</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nextId</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">     </span><span class="k">public</span><span class="w"> </span><span class="nf">Event</span><span class="p">()</span><span class="w"></span>
<span class="linenos">20</span><span class="p">{</span><span class="w"></span>
<span class="linenos">21</span><span class="w">   </span><span class="n">Id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">nextId</span><span class="p">;</span><span class="w"></span>
<span class="linenos">22</span><span class="w">   </span><span class="n">nextId</span><span class="p">++;</span><span class="w"></span>
<span class="linenos">23</span><span class="p">}</span><span class="w"></span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="k">public</span><span class="w"> </span><span class="nf">Event</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">contactEmail</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">()</span><span class="w"></span>
<span class="linenos">26</span><span class="p">{</span><span class="w"></span>
<span class="linenos">27</span><span class="w">   </span><span class="n">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="linenos">28</span><span class="w">   </span><span class="n">Description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"></span>
<span class="linenos">29</span><span class="w">   </span><span class="n">ContactEmail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">contactEmail</span><span class="p">;</span><span class="w"></span>
<span class="linenos">30</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>When introducing this property previously, we intentionally named it <code class="docutils literal notranslate"><span class="pre">Id</span></code> in anticipation of using EF and a data store to persist <code class="docutils literal notranslate"><span class="pre">Event</span></code> objects. EF will <em>automatically</em> consider any property named <code class="docutils literal notranslate"><span class="pre">Id</span></code> to be the primary key for that class. Therefore, we already have the necessary property!</p>
<p>However, there are two changes we need to make:</p>
<ol class="arabic simple">
<li><p>Primary key properties must have both a getter and setter.</p></li>
<li><p>The value of a primary key property is set by the database when an object is first stored. Therefore, we shouldn’t be setting this value in the constructor. So we can remove the code in the constructors that explicitly sets the value of <code class="docutils literal notranslate"><span class="pre">Id</span></code>, along with the <code class="docutils literal notranslate"><span class="pre">nextId</span></code> field.</p></li>
</ol>
<p>So the code sample above can be simplified to the following.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="linenos">16</span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">     </span><span class="k">public</span><span class="w"> </span><span class="nf">Event</span><span class="p">()</span><span class="w"></span>
<span class="linenos">19</span><span class="p">{</span><span class="w"></span>
<span class="linenos">20</span><span class="p">}</span><span class="w"></span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="k">public</span><span class="w"> </span><span class="nf">Event</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">contactEmail</span><span class="p">)</span><span class="w"></span>
<span class="linenos">23</span><span class="p">{</span><span class="w"></span>
<span class="linenos">24</span><span class="w">   </span><span class="n">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="linenos">25</span><span class="w">   </span><span class="n">Description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"></span>
<span class="linenos">26</span><span class="w">   </span><span class="n">ContactEmail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">contactEmail</span><span class="p">;</span><span class="w"></span>
<span class="linenos">27</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<span class="target" id="index-3"></span></div>
</div>
<div class="section" id="migrations-video">
<span id="index-4"></span><h2><span class="section-number">17.2.3. </span>Migrations - Video<a class="headerlink" href="#migrations-video" title="Permalink to this headline"></a></h2>
<p>If you want to verify what code this video starts with, check out the <a class="reference external" href="https://github.com/LaunchCodeEducation/CodingEventsDemo/tree/persistent-data-store" target="_blank">persistent-data-store<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> branch. If you want to verify what code this video ends with, check out the <a class="reference external" href="https://github.com/LaunchCodeEducation/CodingEventsDemo/tree/migrations" target="_blank">migrations<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> branch.</p>

<div style="text-align:center;"><iframe width="800" height="450" src="https://www.youtube.com/embed/q6PfagaiHqE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p></p>
</div>
<div class="section" id="migrations-text">
<h2><span class="section-number">17.2.4. </span>Migrations - Text<a class="headerlink" href="#migrations-text" title="Permalink to this headline"></a></h2>
<p>Our application is now completely configured to store <code class="docutils literal notranslate"><span class="pre">Event</span></code> objects in our MySQL database. However, if you look at the <code class="docutils literal notranslate"><span class="pre">coding_events</span></code> database, you’ll notice that it has no table in which to store such data. To create such a table, we need to create and run a <strong>database migration</strong>. A database migration (or migration, for short) is an update to a database made in order to reflect changes in an application’s model. Every time we change our application’s model by adding or removing a new persistent class, or by modifying a persistent class, we will need to create and run a migration.</p>
<p>The EntityFrameworkCore Tools package we installed in the last section provides tools for working with migrations. To get started, open a terminal (the Terminal app on MacOS or Powershell on Windows). Navigate to the <code class="docutils literal notranslate"><span class="pre">CodingEventsDemo</span></code> project folder <em>within</em> your <code class="docutils literal notranslate"><span class="pre">CodingEventsDemo</span></code> solution. This is the folder that contains <code class="docutils literal notranslate"><span class="pre">Controllers/</span></code>, <code class="docutils literal notranslate"><span class="pre">Views/</span></code>, and so on, and is NOT the main project folder.</p>
<p>Then run the following command to create a migration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ dotnet ef migrations add InitialMigration
</pre></div>
</div>
<p>This instructs the EF tools to create a migration named <code class="docutils literal notranslate"><span class="pre">InitialMigration</span></code>. In doing so, EF scans our project looking for persistent classes (i.e. classes with data stores that have been registered in <code class="docutils literal notranslate"><span class="pre">Startup</span></code>) and compares them to the current state of the MySQL database. If any classes have been added, removed, or changed, it will generate code to update the database to be in sync with the application’s model. This code is stored in the <code class="docutils literal notranslate"><span class="pre">Migrations/</span></code> folder of your project.</p>
<p>In order to run a migration, we issue the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ dotnet ef database update
</pre></div>
</div>
<p>This command will apply the changes to the database. To verify the changes, open MySQL Workbench and notice that there is now an <code class="docutils literal notranslate"><span class="pre">Events</span></code> table with columns corresponding to the properties of our class.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>EntityFrameworkCore uses the <code class="docutils literal notranslate"><span class="pre">_EFMigrationsHistory</span></code> table in the database to keep track of which migrations have already been run. When we run <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">ef</span> <span class="pre">migrations</span> <span class="pre">update</span></code>, EF will reference this table and run <em>all</em> migrations that have not yet been applied, in the correct order.</p>
</div>
<p>The next section will look at how we can store and retrieve <code class="docutils literal notranslate"><span class="pre">Event</span></code> objects from within our controller.</p>
</div>
<div class="section" id="check-your-understanding">
<h2><span class="section-number">17.2.5. </span>Check Your Understanding<a class="headerlink" href="#check-your-understanding" title="Permalink to this headline"></a></h2>
<div class="admonition-question admonition">
<p class="admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p><strong>True/False:</strong> Every persistent class will automatically have a MySQL table created to use to store its data.</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p>A data store should extend which of the following classes in the <code class="docutils literal notranslate"><span class="pre">Microsoft.EntityFrameworkCore</span></code> package?</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataStore</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DbContext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MySqlStore</span></code></p></li>
<li><p>None of the above</p></li>
</ol>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="background.html" class="btn btn-neutral float-left" title="17.1. Object-Relational Mapping" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data-stores.html" class="btn btn-neutral float-right" title="17.3. Working with Data Stores" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, LaunchCode.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>